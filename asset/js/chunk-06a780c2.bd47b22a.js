(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-06a780c2","chunk-78aa0fc1"],{"0b05":function(t,e,a){"use strict";a.r(e);a("b0c0"),a("b64b"),a("ac1f"),a("5319");var n=a("7a23"),i=Object(n["W"])("data-v-33fdbba4");Object(n["C"])("data-v-33fdbba4");var s={class:"box"},c={class:"nav"},o={key:0,class:"head"},u={class:"name1"},r={key:1},l={class:"name2"},p={class:"tab"},h={class:"panel"},d=Object(n["j"])("div",{class:"title"},"项目",-1),b={class:"chooser"},j=Object(n["j"])("div",{class:"title"},"价格",-1),f={class:"chooser"},O={class:"item"},y={class:"sale"},v={class:"face"},g={class:"title"};Object(n["A"])();var m=i((function(t,e,a,m,C,k){var w=Object(n["H"])("van-icon"),x=Object(n["H"])("van-image"),_=Object(n["H"])("van-tab"),H=Object(n["H"])("van-tabs"),S=Object(n["H"])("van-empty"),$=Object(n["H"])("van-field"),N=Object(n["H"])("van-stepper"),P=Object(n["H"])("van-cell"),T=Object(n["H"])("van-action-bar-icon"),L=Object(n["H"])("van-action-bar-button"),I=Object(n["H"])("van-action-bar"),z=Object(n["H"])("van-popup"),E=Object(n["H"])("pay"),V=Object(n["H"])("BaseLayout");return Object(n["z"])(),Object(n["g"])(V,{title:C.state.title,height:"0"},{default:i((function(){return[Object(n["j"])("div",s,[Object(n["j"])("div",c,["coupon"!=a.action?(Object(n["z"])(),Object(n["g"])("div",o,[Object(n["j"])(w,{class:"icon",name:C.state.topCat.icon||"vip-card",size:"36"},null,8,["name"]),Object(n["j"])("div",u,Object(n["L"])(C.state.topCat.name),1)])):Object(n["T"])((Object(n["z"])(),Object(n["g"])("div",r,[Object(n["j"])(x,{src:C.state.topCat.icon},null,8,["src"]),Object(n["j"])("div",l,Object(n["L"])(C.state.topCat.name),1)],512)),[[n["P"],!C.state.subCat||0==Object.keys(C.state.subCat).length]]),C.state.subCat&&Object.keys(C.state.subCat).length>0?(Object(n["z"])(),Object(n["g"])(H,{key:2,class:["tabs",a.action],active:C.state.active,"onUpdate:active":e[1]||(e[1]=function(t){return C.state.active=t}),"swipe-threshold":3,animated:"",swipeable:"",onChange:k.handleChange},{default:i((function(){return[(Object(n["z"])(!0),Object(n["g"])(n["a"],null,Object(n["F"])(C.state.subCat,(function(t,e){return Object(n["z"])(),Object(n["g"])(_,{key:e,name:t.id},{title:i((function(){return[Object(n["j"])("div",p,[Object(n["j"])(w,{name:t.icon,size:"36"},null,8,["name"]),Object(n["i"])(Object(n["L"])(t.name),1)])]})),_:2},1032,["name"])})),128))]})),_:1},8,["class","active","onChange"])):Object(n["h"])("",!0)]),Object(n["T"])(Object(n["j"])("div",h,[d,Object(n["j"])("div",b,[(Object(n["z"])(!0),Object(n["g"])(n["a"],null,Object(n["F"])(C.state.spu,(function(t,e){return Object(n["z"])(),Object(n["g"])("div",{class:["spu",{active:C.state.id==t.id}],key:e,onClick:function(e){return k.handleChoose(t)}},Object(n["L"])(t.title),11,["onClick"])})),128))]),j,Object(n["j"])("div",f,[(Object(n["z"])(!0),Object(n["g"])(n["a"],null,Object(n["F"])(C.state.sku,(function(t,e){return Object(n["T"])((Object(n["z"])(),Object(n["g"])("div",{class:["sku",{more:Object.keys(C.state.sku).length>3,active:C.state.api==e}],key:e,onClick:function(t){return C.state.api=e}},[Object(n["j"])("div",O,Object(n["L"])(t.name),1),Object(n["j"])("div",y,"￥"+Object(n["L"])(t.sale_price),1),Object(n["j"])("div",v,"官方价：￥"+Object(n["L"])(t.face_price.replace(".00","")),1)],10,["onClick"])),[[n["P"],t.stock>0]])})),128))]),Object(n["T"])(Object(n["j"])("div",g,"描述",512),[[n["P"],C.state.intro]]),Object(n["T"])(Object(n["j"])("div",{class:"intro",innerHTML:t.$safeHTML(C.state.intro)},null,8,["innerHTML"]),[[n["P"],C.state.intro]])],512),[[n["P"],Object.keys(C.state.spu).length>0]]),Object(n["T"])(Object(n["j"])(S,{description:"暂无项目"},null,512),[[n["P"],0==Object.keys(C.state.spu).length]])]),Object(n["j"])(I,{class:"bar"},{default:i((function(){return[Object(n["T"])(Object(n["j"])($,{class:"param",modelValue:C.state.account,"onUpdate:modelValue":e[2]||(e[2]=function(t){return C.state.account=t}),type:"text",placeholder:"充值账号"},null,8,["modelValue"]),[[n["P"],0==C.state.type&&C.state.api.length>0]]),Object(n["T"])(Object(n["j"])(P,{class:"param",title:"购买数量"},{value:i((function(){return[Object(n["j"])(N,{modelValue:C.state.entity,"onUpdate:modelValue":e[3]||(e[3]=function(t){return C.state.entity=t}),theme:"round","input-width":"42","button-size":"24","disable-input":!1,min:"1",max:"100",integer:""},null,8,["modelValue"])]})),_:1},512),[[n["P"],1==C.state.type&&C.state.api.length>0]]),Object(n["j"])(T,{icon:"chat-o",text:"客服",onClick:e[4]||(e[4]=function(t){return C.state.popup=!0})}),Object(n["j"])(T,{icon:"cash-on-deliver",text:"订单",onClick:e[5]||(e[5]=function(e){return t.$router.push("/digital/order")})}),Object(n["j"])(L,{type:"danger",text:"立即购买",onClick:k.handleSubmit},null,8,["onClick"])]})),_:1}),Object(n["j"])(z,{show:C.state.popup,"onUpdate:show":e[6]||(e[6]=function(t){return C.state.popup=t}),position:"top",style:{height:"50%",padding:"20px"}},{default:i((function(){return[Object(n["j"])("div",{class:"contact",innerHTML:t.config.contact},null,8,["innerHTML"])]})),_:1},8,["show"]),Object(n["j"])(E,Object(n["q"])(C.state.payData,{show:C.state.payShow,"onUpdate:show":e[7]||(e[7]=function(t){return C.state.payShow=t}),onOnFinish:k.handlePay}),null,16,["show","onOnFinish"])]})),_:1},8,["title"])})),C=a("5530"),k=(a("a9e3"),a("5502")),w=a("2824"),x=a("a6e6"),_={components:{BaseLayout:w["a"],Pay:x["default"]},name:"DigitalDetail",props:{action:{type:String,default:"member"},cid:{type:[String,Number],default:0},id:{type:[String,Number],default:0}},data:function(){var t=Object(n["D"])({topCat:{},subCat:{},active:0,list:{},spu:{},sku:{},item:{},type:0,title:"",intro:"",id:0,api:0,account:"",quantity:1,payData:{},payShow:!1,popup:!1});return{state:t}},created:function(){var t=this;this.$http.get("/digital/category?type="+this.action+"&deep=0").then((function(e){t.state.title=e[0].name})),this.$http.post("/digital/category?id="+parseInt(this.cid)+"&deep=2").then((function(e){t.state.topCat=e[0],t.state.subCat=e[0]["children"],t.init()}))},computed:Object(C["a"])(Object(C["a"])({},Object(k["d"])(["config","profile"])),Object(k["b"])(["uid"])),watch:{$route:function(t,e){t.path==e.path&&t.query==e.query||setTimeout(this.init,100)}},methods:{init:function(){var t=this,e=/(\d+)[^\d](\d+)/.exec(this.cid);this.$http.post("/digital/list?cid="+(e?e[1]:this.cid)).then((function(a){t.state.list=a,t.state.active=e?e[2]:Object.keys(a).shift(),t.handleChange()}))},handleChange:function(){this.state.spu=this.state.list[this.state.active]||{},this.state.id=this.id||Object.keys(this.state.spu).shift(),this.handleChoose(this.state.spu[this.state.id]||null)},handleChoose:function(t){t&&"undefined"!=typeof t.id&&(this.state.item=t,this.state.id=t.id,this.state.type=t.type,this.state.intro=t.intro,this.state.api="",this.state.sku=JSON.parse(t.spec))},handleSubmit:function(){var t=this;return this.state.id<=0||this.state.api.length<=0?this.$toast("请选择项目及价格"):0==this.state.type&&this.state.account.length<5?this.$toast("请填写充值账号"):(0==this.state.type&&(this.state.quantity=1),1==this.state.type&&(this.state.account=""),void this.$http.post("/digital/checkout?id="+this.state.id+"&api="+this.state.api+"&account="+this.state.account+"&quantity="+this.state.quantity).then((function(e){t.state.payData=Object(C["a"])(Object(C["a"])({},e),{},{json:JSON.stringify(e)}),t.state.payShow=!0})))},handlePay:function(t){this.state.payShow=!1,t&&this.$dialog.alert({title:"订单已生成",message:"请点击下方“订单记录”查看到账情况",theme:"round-button"})}}},H=(a("da39"),a("6b0d")),S=a.n(H);const $=S()(_,[["render",m],["__scopeId","data-v-33fdbba4"]]);e["default"]=$},"13ab":function(t,e,a){"use strict";(function(t){var n=a("53ca"),i=a("5530"),s=(a("a9e3"),a("7a23")),c=a("5502"),o=a("2824"),u=a("922d");e["a"]={components:{BaseLayout:o["a"],Coupon:u["default"]},name:"Pay",props:{show:{type:Boolean,default:!1},json:{type:String,default:""},oid:{type:[String,Number],default:""},fee:{type:[String,Number],default:0},subject:{type:[String,Number],default:""},tag:{type:[String,Number],default:""},attach:{type:String,default:""},notify:{type:String,default:""},exprie:{type:[String,Number],default:0},dt:{type:String,default:""}},emits:["update:show"],data:function(){var t=Object(s["D"])({useCash:!0,usePoint:!0,type:"",cid:"",pid:"",showCoupon:!1,coupon:{id:-1},discount:""});return{state:t}},create:function(){this.$init()},computed:Object(i["a"])({popup:{get:function(){return this.show},set:function(t){this.state.showCoupon=!1,this.$emit("update:show",t)}}},Object(c["d"])(["profile"])),methods:Object(i["a"])({handleCoupon:function(t){this.state.showCoupon=!1,this.state.cid="",this.state.discount=0,t&&(this.state.cid=t.id,this.state.discount=Math.round(100*t.save)/100)},handlePay:function(){return this.state.useCash||this.state.usePoint?this.state.useCash&&!this.state.usePoint&&(this.state.type="cash",this.fee-this.state.discount-parseFloat(this.profile.cash)>0)?this.$toast("余额不足支付"):!this.state.useCash&&this.state.usePoint&&(this.state.type="point",this.fee-this.state.discount-parseFloat(this.profile.point)>0)?this.$toast("积分不足支付"):this.state.useCash&&this.state.usePoint&&(this.state.type="",this.fee-this.state.discount-parseFloat(this.profile.cash)-parseFloat(this.profile.point)>0)?this.$toast("账户资产不足，请使用微信支付"):void this.pay():this.$toast("至少选择一种支付方式")},handleWxPay:function(){var t=this;this.$http.post("/wechat/pay?fee="+this.fee+"&name="+this.subject+"&attach="+this.attach).then((function(e){t.state.popup=!1,t.state.pid=e.pid,e.code&&t.$dialog.confirm({title:"请用微信扫码付款",message:"<img src='http://api.qrserver.com/v1/create-qr-code/?size=250x250&ecc=H&margin=10&data="+e.code+"'>",theme:"round-button",confirmButtonText:"我已完成付款",allowHtml:!0}).then(t.wxpayCheck)||WeixinJSBridge&&WeixinJSBridge.invoke("getBrandWCPayRequest",e,(function(e){return"get_brand_wcpay_request:ok"!=e.err_msg?t.$dialog.alert({message:"微信支付失败，请重试！"}):t.wxpayCheck()}))}))},wxpayCheck:function(){var e=this;this.popup&&(this.$toast.loading({message:"订单处理中...",forbidClick:!0}),setTimeout((function(){0==document.querySelector("#pay").getBoundingClientRect()["height"]&&(e.popup=!1),e.$http.post("/wechat/payCheck?id="+e.state.pid).then((function(a){return t.isEmpty(a)||Object(n["a"])(a.attach)!=e.attach?e.wxpayCheck():(e.popup=!1,e.state.type="wxpay",e.pay())}))}),5e3))},pay:function(){var t=this;this.$http.post("/pay?order="+this.json+"&type="+this.state.type+"&cid="+this.state.cid+"&pid="+this.state.pid).then((function(e,a){t.$init(),t.popup=!1,t.$emit("onFinish",!0,a,e)})).catch((function(e){t.popup=!1,t.$emit("onFinish",!1,e.msg)}))}},Object(c["c"])(["auth"]))}}).call(this,a("81b0"))},"316e":function(t,e,a){},"3eea":function(t,e,a){},5899:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(t,e,a){var n=a("1d80"),i=a("5899"),s="["+i+"]",c=RegExp("^"+s+s+"*"),o=RegExp(s+s+"*$"),u=function(t){return function(e){var a=String(n(e));return 1&t&&(a=a.replace(c,"")),2&t&&(a=a.replace(o,"")),a}};t.exports={start:u(1),end:u(2),trim:u(3)}},"6f82":function(t,e,a){},7156:function(t,e,a){var n=a("861d"),i=a("d2bb");t.exports=function(t,e,a){var s,c;return i&&"function"==typeof(s=e.constructor)&&s!==a&&n(c=s.prototype)&&c!==a.prototype&&i(t,c),t}},"922d":function(t,e,a){"use strict";a.r(e);var n=a("7a23"),i=Object(n["W"])("data-v-1aaec02a");Object(n["C"])("data-v-1aaec02a");var s={class:"toolbar"},c=Object(n["i"])("不使用优惠券"),o=Object(n["i"])("转赠选中的优惠券"),u=Object(n["i"])("转赠");Object(n["A"])();var r=i((function(t,e,a,r,l,p){var h=Object(n["H"])("van-button"),d=Object(n["H"])("van-coupon-list"),b=Object(n["H"])("van-field"),j=Object(n["H"])("van-action-sheet"),f=Object(n["H"])("BaseLayout");return Object(n["z"])(),Object(n["g"])(f,{title:"我的优惠券",navbar:a.inpay?"hide":"show"},{default:i((function(){return[Object(n["j"])("div",s,[Object(n["T"])(Object(n["j"])(h,{type:"primary",block:"",onClick:e[1]||(e[1]=function(t){return p.onChange(-1)})},{default:i((function(){return[c]})),_:1},512),[[n["P"],a.inpay]]),Object(n["T"])(Object(n["j"])(h,{type:"primary",block:"",onClick:e[2]||(e[2]=function(t){return l.state.popup=!0})},{default:i((function(){return[o]})),_:1},512),[[n["P"],!a.inpay&&l.state.index>-1]])]),Object(n["j"])(d,{class:"list","displayed-coupon-index":0,code:l.state.code,"onUpdate:code":e[3]||(e[3]=function(t){return l.state.code=t}),coupons:l.state.list1,"disabled-coupons":l.state.list0,"chosen-coupon":l.state.index,"show-close-button":!1,onChange:p.onChange,onExchange:p.onExchange},null,8,["code","coupons","disabled-coupons","chosen-coupon","onChange","onExchange"]),Object(n["j"])(j,{show:l.state.popup,"onUpdate:show":e[5]||(e[5]=function(t){return l.state.popup=t}),title:"转赠优惠券",round:"",closeable:""},{default:i((function(){return[Object(n["j"])(b,{type:"text",border:1,modelValue:l.state.account,"onUpdate:modelValue":e[4]||(e[4]=function(t){return l.state.account=t}),"input-align":"center",clearable:"",placeholder:"请输入接收人UID或手机号",style:{margin:"20px 0"}},null,8,["modelValue"]),Object(n["j"])(h,{round:"",block:"",type:"primary",style:{margin:"10px 0"},onClick:p.onTransfer},{default:i((function(){return[u]})),_:1},8,["onClick"])]})),_:1},8,["show"])]})),_:1},8,["navbar"])})),l=a("5530"),p=(a("a9e3"),a("2824")),h={components:{BaseLayout:p["a"]},name:"Coupon",props:{tag:{type:String,default:""},amount:{type:[String,Number],default:0},inpay:{type:Boolean,default:!1}},data:function(){var t=Object(n["D"])({code:"",account:"",list0:[],list1:[],index:-1,popup:!1});return{state:t}},created:function(){this.onLoad()},methods:{onLoad:function(){var t=this;this.state.popup=!1,this.state.list0=[],this.state.list1=[],this.$http.get("/coupon/query?tag="+this.tag+"&amount="+this.amount).then((function(e){for(var a in e){var n=e[a];n=Object(l["a"])(Object(l["a"])({},n),{name:n.title,condition:"满 "+n.amount+" 元\n"+(1==n.type?"减":"打")+" "+n.discount+" "+(1==n.type?"元":"折"),startAt:new Date(n.dt_start).getTime()/1e3,endAt:new Date(n.dt_end).getTime()/1e3,description:n.intro,valueDesc:n.discount,unitDesc:1==n.type?"元":"折"}),n["status"]>0&&t.state.list0.push(n)||t.state.list1.push(n)}}))},onChange:function(t){this.state.index=t,this.inpay&&this.$emit("onChoose",this.state.list1[t]||null)},onExchange:function(){this.$http.post("/coupon/exchange?code="+this.state.code).then(this.onLoad)},onTransfer:function(){this.state.account.length>=3&&this.$http.post("/coupon/transfer?u="+this.state.account).then(this.onLoad)}}},d=(a("bc3f"),a("6b0d")),b=a.n(d);const j=b()(h,[["render",r],["__scopeId","data-v-1aaec02a"]]);e["default"]=j},a6e6:function(t,e,a){"use strict";a.r(e);var n=a("7a23"),i=Object(n["W"])("data-v-b45cb682");Object(n["C"])("data-v-b45cb682");var s=Object(n["j"])("div",{class:"title"},"收银台",-1),c={class:"box"},o={id:"pay",class:"fee"},u={class:"subject"},r=Object(n["i"])(" "),l=Object(n["i"])(" "),p=Object(n["i"])("立即付款"),h=Object(n["i"])("使用微信支付");Object(n["A"])();var d=i((function(t,e,a,d,b,j){var f=Object(n["H"])("van-icon"),O=Object(n["H"])("van-cell"),y=Object(n["H"])("van-switch"),v=Object(n["H"])("van-button"),g=Object(n["H"])("van-popup"),m=Object(n["H"])("Coupon"),C=Object(n["H"])("van-action-sheet"),k=Object(n["H"])("BaseLayout");return Object(n["z"])(),Object(n["g"])(k,{title:"收银台",navbar:"hide"},{default:i((function(){return[Object(n["j"])(g,{show:j.popup,"onUpdate:show":e[4]||(e[4]=function(t){return j.popup=t}),position:"bottom",style:{height:"100%"},"close-on-click-overlay":!1,"close-on-popstate":!0,"safe-area-inset-bottom":"",closeable:""},{default:i((function(){return[s,Object(n["j"])("div",c,[Object(n["j"])("div",o,[Object(n["j"])(f,{name:"points",size:"20"}),Object(n["i"])(" "+Object(n["L"])(a.fee),1)]),Object(n["j"])("div",u,Object(n["L"])(a.subject),1),Object(n["j"])(O,{title:"订单编号",value:a.oid},null,8,["value"]),Object(n["T"])(Object(n["j"])(O,{title:"优惠券",value:b.state.discount?"优惠 "+b.state.discount:"","is-link":"",onClick:e[1]||(e[1]=function(t){return b.state.showCoupon=!0})},null,8,["value"]),[[n["P"],a.tag.length>0]]),Object(n["j"])(O,{title:"余额支付",value:"（"+t.profile.cash+" 可用）"},{"right-icon":i((function(){return[r,Object(n["j"])(y,{modelValue:b.state.useCash,"onUpdate:modelValue":e[2]||(e[2]=function(t){return b.state.useCash=t}),size:"24"},null,8,["modelValue"])]})),_:1},8,["value"]),Object(n["j"])(O,{title:"积分支付",value:"（"+t.profile.point+" 可用）"},{"right-icon":i((function(){return[l,Object(n["j"])(y,{modelValue:b.state.usePoint,"onUpdate:modelValue":e[3]||(e[3]=function(t){return b.state.usePoint=t}),size:"24"},null,8,["modelValue"])]})),_:1},8,["value"]),Object(n["j"])(O,{title:"下单时间",value:a.dt},null,8,["value"]),Object(n["j"])(v,{class:"submit",type:"primary",round:"",block:"",onClick:j.handlePay},{default:i((function(){return[p]})),_:1},8,["onClick"]),Object(n["j"])(v,{type:"success",icon:"wechat-pay",round:"",block:"",plain:"",onClick:j.handleWxPay},{default:i((function(){return[h]})),_:1},8,["onClick"])])]})),_:1},8,["show"]),Object(n["j"])(C,{show:b.state.showCoupon,"onUpdate:show":e[5]||(e[5]=function(t){return b.state.showCoupon=t}),title:"选择优惠券",closeable:!1,"close-on-popstate":!0,"close-on-click-overlay":!1},{default:i((function(){return[Object(n["j"])(m,{tag:a.tag,amount:a.fee,inpay:"",onOnChoose:j.handleCoupon},null,8,["tag","amount","onOnChoose"])]})),_:1},8,["show"])]})),_:1})})),b=a("13ab"),j=(a("de05"),a("6b0d")),f=a.n(j);const O=f()(b["a"],[["render",d],["__scopeId","data-v-b45cb682"]]);e["default"]=O},a9e3:function(t,e,a){"use strict";var n=a("83ab"),i=a("da84"),s=a("94ca"),c=a("6eeb"),o=a("5135"),u=a("c6b6"),r=a("7156"),l=a("c04e"),p=a("d039"),h=a("7c73"),d=a("241c").f,b=a("06cf").f,j=a("9bf2").f,f=a("58a8").trim,O="Number",y=i[O],v=y.prototype,g=u(h(v))==O,m=function(t){var e,a,n,i,s,c,o,u,r=l(t,!1);if("string"==typeof r&&r.length>2)if(r=f(r),e=r.charCodeAt(0),43===e||45===e){if(a=r.charCodeAt(2),88===a||120===a)return NaN}else if(48===e){switch(r.charCodeAt(1)){case 66:case 98:n=2,i=49;break;case 79:case 111:n=8,i=55;break;default:return+r}for(s=r.slice(2),c=s.length,o=0;o<c;o++)if(u=s.charCodeAt(o),u<48||u>i)return NaN;return parseInt(s,n)}return+r};if(s(O,!y(" 0o1")||!y("0b1")||y("+0x1"))){for(var C,k=function(t){var e=arguments.length<1?0:t,a=this;return a instanceof k&&(g?p((function(){v.valueOf.call(a)})):u(a)!=O)?r(new y(m(e)),a,k):m(e)},w=n?d(y):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),x=0;w.length>x;x++)o(y,C=w[x])&&!o(k,C)&&j(k,C,b(y,C));k.prototype=v,v.constructor=k,c(i,O,k)}},bc3f:function(t,e,a){"use strict";a("6f82")},da39:function(t,e,a){"use strict";a("3eea")},de05:function(t,e,a){"use strict";a("316e")}}]);